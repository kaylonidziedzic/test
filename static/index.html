<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CF-Gateway 管理控制台</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Noto Sans SC', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="/static/app.css">
</head>

<body class="antialiased h-screen overflow-hidden bg-zinc-50">

    <div id="init-loader" class="fixed inset-0 z-[9999] flex flex-col items-center justify-center bg-white">
        <div class="loader mb-4" style="width: 32px; height: 32px;"></div>
        <div class="text-zinc-500 text-sm">系统初始化中...</div>
    </div>

    <div id="app" v-cloak class="h-full flex">

        <!-- Login -->
        <div v-if="!authenticated"
            class="fixed inset-0 flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 px-4">
            <div class="w-full max-w-sm bg-white border border-zinc-200 rounded-xl p-8 shadow-2xl">
                <div class="flex items-center gap-3 mb-8">
                    <div
                        class="w-12 h-12 bg-gradient-to-br from-blue-600 to-blue-500 rounded-xl flex items-center justify-center text-white shadow-lg">
                        <i class="ri-shield-keyhole-fill text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-zinc-900">CF-Gateway</h1>
                        <p class="text-xs text-zinc-500">企业级管理控制台</p>
                    </div>
                </div>
                <form @submit.prevent="login" class="space-y-5">
                    <div>
                        <label class="block text-xs font-semibold text-zinc-700 mb-2">访问密钥</label>
                        <input type="password" v-model="apiKey"
                            class="w-full bg-zinc-50 border border-zinc-300 rounded-lg px-4 py-3 text-sm text-zinc-900 focus:ring-2 focus:ring-blue-500 outline-none placeholder-zinc-400"
                            placeholder="请输入 API 密钥..." autofocus>
                    </div>
                    <button type="submit" :disabled="loading || !apiKey"
                        class="w-full bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white font-semibold rounded-lg py-3 text-sm flex items-center justify-center gap-2 disabled:opacity-50 shadow-lg">
                        <span v-if="loading" class="loader w-4 h-4"></span>
                        <i v-else class="ri-login-circle-line text-lg"></i>
                        <span>{{ loading ? '登录中...' : '登录' }}</span>
                    </button>
                </form>
                <p v-if="loginError" class="mt-4 text-center text-red-500 text-xs">
                    <i class="ri-error-warning-line mr-1"></i>{{ loginError }}
                </p>
            </div>
        </div>

        <!-- Dashboard -->
        <template v-else>

            <!-- Sidebar -->
            <aside class="w-64 bg-white border-r border-zinc-200 flex flex-col hidden lg:flex">
                <div class="h-16 flex items-center justify-between px-6 border-b border-zinc-200">
                    <div class="flex items-center gap-2 text-zinc-900 font-semibold">
                        <i class="ri-cloud-windy-line text-blue-500 text-xl"></i>
                        <span>CF-Gateway</span>
                    </div>
                </div>

                <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
                    <div v-for="tab in visibleTabs" :key="tab.id" @click="switchTab(tab.id)"
                        :class="['flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium cursor-pointer transition-all',
                            activeTab === tab.id ? 'bg-blue-50 text-blue-600 shadow-sm' : 'text-zinc-600 hover:bg-zinc-50 hover:text-zinc-900']">
                        <i :class="[tab.icon, 'text-lg', activeTab === tab.id ? 'text-blue-500' : '']"></i>
                        {{ tab.name }}
                    </div>
                </nav>

                <div class="p-4 border-t border-zinc-200 bg-zinc-50">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                            <span class="text-xs text-zinc-600 font-mono">{{ status.uptime_human || '在线' }}</span>
                        </div>
                    </div>
                    <button @click="logout"
                        class="w-full flex items-center justify-center gap-2 px-3 py-2 text-xs font-medium text-zinc-600 hover:text-zinc-900 hover:bg-zinc-100 rounded-lg transition-all">
                        <i class="ri-logout-box-r-line"></i> 退出登录
                    </button>
                </div>
            </aside>

            <!-- Mobile Nav -->
            <div class="lg:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-zinc-200 z-40">
                <div class="flex items-center justify-around px-2">
                    <button v-for="tab in visibleTabs.slice(0, 5)" :key="tab.id" @click="switchTab(tab.id)" :class="['flex flex-col items-center py-2 px-3 text-xs font-medium relative',
                            activeTab === tab.id ? 'text-blue-600' : 'text-zinc-500']">
                        <i :class="[tab.icon, 'text-xl mb-0.5']"></i>
                        <span class="text-[10px]">{{ tab.name }}</span>
                        <span v-if="activeTab === tab.id"
                            class="absolute bottom-0 left-1/2 -translate-x-1/2 w-8 h-0.5 bg-blue-600 rounded-full"></span>
                    </button>
                </div>
            </div>

            <!-- Main -->
            <div class="flex-1 flex flex-col bg-zinc-50 overflow-hidden">
                <header
                    class="h-16 border-b border-zinc-200 flex items-center justify-between px-4 lg:px-8 bg-white/80 backdrop-blur-md">
                    <div>
                        <h2 class="text-sm font-semibold text-zinc-900">{{ currentTabName }}</h2>
                        <p class="text-xs text-zinc-500 hidden sm:block">{{ currentTabDesc }}</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <div
                            class="hidden xl:flex items-center gap-2 bg-white border border-zinc-200 rounded-lg px-3 py-1.5">
                            <i class="ri-link text-zinc-400 text-sm"></i>
                            <input v-model="apiBaseUrl" type="text" placeholder="后端地址，例如 http://localhost:8000"
                                class="bg-transparent text-xs text-zinc-900 placeholder-zinc-500 outline-none w-56">
                            <button @click="saveBaseUrl"
                                class="text-xs text-blue-600 hover:text-blue-500 font-semibold">保存</button>
                        </div>
                        <div
                            class="hidden lg:flex items-center gap-2 bg-white border border-zinc-200 rounded-lg px-3 py-1.5">
                            <span
                                :class="['w-2 h-2 rounded-full', sseConnected ? 'bg-green-500 animate-pulse' : autoRefresh ? 'bg-amber-500' : 'bg-zinc-300']"></span>
                            <span class="text-[11px] text-zinc-600 font-medium">{{ sseConnected ? 'SSE 已连接' :
                                autoRefresh ? '轮询中' : '已暂停' }}</span>
                        </div>
                        <div
                            class="hidden md:flex items-center gap-2 bg-zinc-100 border border-zinc-200 rounded-lg px-3 py-1.5">
                            <i class="ri-search-line text-zinc-400 text-sm"></i>
                            <input v-model="searchQuery" type="text" placeholder="搜索..."
                                class="bg-transparent text-xs text-zinc-900 placeholder-zinc-500 outline-none w-32">
                        </div>
                        <div
                            class="hidden lg:flex items-center gap-2 bg-white border border-zinc-200 rounded-lg px-3 py-1.5">
                            <i class="ri-user-line text-zinc-400 text-sm"></i>
                            <select v-model="requestUserFilter"
                                class="bg-transparent text-xs text-zinc-900 outline-none">
                                <option value="all">全部用户</option>
                                <option v-for="u in userOptions" :key="u" :value="u">{{ u }}</option>
                            </select>
                        </div>
                        <span class="hidden sm:inline text-xs text-zinc-500 font-mono">v{{ status.version || '4.3.0'
                            }}</span>
                        <button @click="toggleAutoRefresh"
                            class="p-2 text-zinc-600 hover:text-zinc-900 hover:bg-zinc-100 rounded-lg transition-all">
                            <i :class="[autoRefresh ? 'ri-pause-line' : 'ri-play-line', 'text-sm']"></i>
                        </button>
                        <button @click="muteErrors()"
                            class="p-2 text-zinc-600 hover:text-zinc-900 hover:bg-zinc-100 rounded-lg transition-all"
                            title="静音错误提示 60 秒">
                            <i class="ri-volume-mute-line text-sm"></i>
                        </button>
                        <button @click="loadData"
                            class="p-2 text-zinc-600 hover:text-zinc-900 hover:bg-zinc-100 rounded-lg transition-all">
                            <i class="ri-refresh-line text-sm"></i>
                        </button>
                    </div>
                </header>

                <main class="flex-1 overflow-y-auto p-4 lg:p-8 pb-20 lg:pb-8">
                    <div class="max-w-7xl mx-auto space-y-6">

                        <!-- MONITOR -->
                        <div v-if="activeTab === 'monitor'" class="space-y-6">
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                                <div
                                    class="bg-white border border-zinc-200 rounded-xl p-5 hover:shadow-lg transition-all">
                                    <div class="flex items-start justify-between mb-3">
                                        <div class="text-xs font-semibold text-zinc-500 uppercase">总请求数</div>
                                        <div class="p-2 bg-blue-50 rounded-lg"><i
                                                class="ri-bar-chart-box-line text-blue-600"></i></div>
                                    </div>
                                    <div class="text-3xl font-bold text-zinc-900">{{ (stats.requests?.total ||
                                        0).toLocaleString() }}</div>
                                </div>
                                <div
                                    class="bg-white border border-zinc-200 rounded-xl p-5 hover:shadow-lg transition-all">
                                    <div class="flex items-start justify-between mb-3">
                                        <div class="text-xs font-semibold text-zinc-500 uppercase">成功率</div>
                                        <div class="p-2 bg-green-50 rounded-lg"><i
                                                class="ri-checkbox-circle-line text-green-600"></i></div>
                                    </div>
                                    <div class="text-3xl font-bold text-green-600">{{ stats.requests?.success_rate || 0
                                        }}%</div>
                                </div>
                                <div
                                    class="bg-white border border-zinc-200 rounded-xl p-5 hover:shadow-lg transition-all">
                                    <div class="flex items-start justify-between mb-3">
                                        <div class="text-xs font-semibold text-zinc-500 uppercase">浏览器池</div>
                                        <div class="p-2 bg-purple-50 rounded-lg"><i
                                                class="ri-cpu-line text-purple-600"></i></div>
                                    </div>
                                    <div class="flex items-baseline gap-2">
                                        <div class="text-3xl font-bold text-zinc-900">{{ stats.browser_pool?.available
                                            || 0 }}</div>
                                        <div class="text-lg text-zinc-500">/ {{ stats.browser_pool?.total || 0 }}</div>
                                    </div>
                                </div>
                                <div
                                    class="bg-white border border-zinc-200 rounded-xl p-5 hover:shadow-lg transition-all">
                                    <div class="flex items-start justify-between mb-3">
                                        <div class="text-xs font-semibold text-zinc-500 uppercase">平均延迟</div>
                                        <div class="p-2 bg-orange-50 rounded-lg"><i
                                                class="ri-timer-line text-orange-600"></i></div>
                                    </div>
                                    <div class="text-3xl font-bold text-zinc-900">{{ stats.requests?.avg_time_ms || 0
                                        }}<span class="text-lg font-normal text-zinc-500 ml-1">ms</span></div>
                                </div>
                            </div>

                            <!-- Charts -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div
                                    class="bg-white border border-zinc-200 rounded-xl p-6 hover:shadow-lg transition-all">
                                    <div class="flex items-center justify-between mb-6">
                                        <div>
                                            <h3 class="text-sm font-semibold text-zinc-900">成功率趋势</h3>
                                            <p class="text-xs text-zinc-500 mt-1">最近 60 个数据点</p>
                                        </div>
                                        <span
                                            class="flex items-center gap-1.5 px-2.5 py-1 bg-blue-50 text-blue-600 rounded-lg text-xs font-medium border border-blue-200">
                                            <span class="w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse"></span> 实时
                                        </span>
                                    </div>
                                    <div class="h-64"><line-chart :data="timeSeries"></line-chart></div>
                                </div>

                                <div
                                    class="bg-white border border-zinc-200 rounded-xl p-6 hover:shadow-lg transition-all">
                                    <div class="mb-6">
                                        <h3 class="text-sm font-semibold text-zinc-900">请求分布</h3>
                                        <p class="text-xs text-zinc-500 mt-1">按状态码分类</p>
                                    </div>
                                    <div class="h-64 flex items-center justify-center">
                                        <donut-chart :data="requestDistribution"></donut-chart>
                                    </div>
                                </div>
                            </div>

                            <!-- Table -->
                            <div
                                class="border border-zinc-200 rounded-xl overflow-hidden bg-white hover:shadow-lg transition-all">
                                <div
                                    class="bg-zinc-50 px-6 py-4 border-b border-zinc-200 flex items-center justify-between">
                                    <h3 class="text-sm font-semibold text-zinc-900">最近活动</h3>
                                    <button @click="exportRequests"
                                        class="text-xs text-zinc-600 hover:text-zinc-900 flex items-center gap-1 transition-all">
                                        <i class="ri-download-line"></i> 导出
                                    </button>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm">
                                        <thead class="bg-zinc-50 text-zinc-600 text-xs font-semibold uppercase">
                                            <tr>
                                                <th class="px-6 py-3 text-left">状态</th>
                                                <th class="px-6 py-3 text-left">URL</th>
                                                <th class="px-6 py-3 text-right">延迟</th>
                                                <th class="px-6 py-3 text-right">时间</th>
                                                <th class="px-6 py-3 text-center">操作</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-zinc-200 text-zinc-700">
                                            <tr v-for="req in filteredRequests" :key="req.id"
                                                class="hover:bg-zinc-50 transition-all">
                                                <td class="px-6 py-4">
                                                    <span
                                                        :class="['inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-semibold',
                                                        req.success ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700']">
                                                        <i
                                                            :class="req.success ? 'ri-checkbox-circle-fill mr-1' : 'ri-close-circle-fill mr-1'"></i>
                                                        {{ req.success ? '成功' : '失败' }}
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4 font-mono text-xs max-w-xs truncate">{{ req.url }}
                                                </td>
                                                <td class="px-6 py-4 text-right font-mono text-zinc-600">{{
                                                    req.duration_ms }}ms</td>
                                                <td class="px-6 py-4 text-right text-zinc-600">{{ req.timestamp?.split(' ')[1] }}</td>
                                                <td class="px-6 py-4 text-center">
                                                    <button @click="showRequestDetail(req)"
                                                        class="text-zinc-500 hover:text-blue-600 transition-all">
                                                        <i class="ri-eye-line text-lg"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr v-if="filteredRequests.length === 0">
                                                <td colspan="5" class="px-6 py-16 text-center">
                                                    <i class="ri-inbox-line text-4xl text-zinc-300 mb-2 block"></i>
                                                    <p class="text-zinc-500 text-sm">暂无请求记录</p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- RULES 规则配置 -->
                        <div v-if="activeTab === 'rules'" class="space-y-6">
                            <!-- 快速测试 -->
                            <div class="bg-white border border-zinc-200 rounded-xl shadow-lg overflow-hidden">
                                <div
                                    class="px-6 py-4 border-b border-zinc-200 bg-gradient-to-r from-purple-50 to-blue-50">
                                    <h3 class="text-sm font-semibold text-zinc-900 flex items-center gap-2">
                                        <i class="ri-flashlight-line text-purple-600"></i> 快速测试
                                    </h3>
                                    <p class="text-xs text-zinc-500 mt-1">输入 URL 快速测试采集效果，无需创建规则</p>
                                </div>
                                <div class="p-6 space-y-4">
                                    <div class="flex gap-3">
                                        <input v-model="testUrl" type="url" placeholder="https://example.com/page"
                                            class="flex-1 bg-zinc-50 border border-zinc-300 rounded-lg px-4 py-2.5 text-sm font-mono outline-none focus:ring-2 focus:ring-purple-500">
                                        <button @click="testBypass" :disabled="testing || !testUrl"
                                            class="px-5 py-2.5 bg-purple-600 hover:bg-purple-500 text-white text-sm font-medium rounded-lg disabled:opacity-50 flex items-center gap-2">
                                            <i v-if="!testing" class="ri-play-line"></i>
                                            <span class="loader w-4 h-4" v-else></span>
                                            {{ testing ? '测试中...' : '测试' }}
                                        </button>
                                    </div>
                                    <div class="grid grid-cols-3 gap-3">
                                        <div>
                                            <label class="block text-xs text-zinc-500 mb-1">接口类型</label>
                                            <select v-model="quickTestParams.api_type"
                                                class="w-full bg-zinc-50 border border-zinc-300 rounded-lg px-3 py-2 text-sm outline-none">
                                                <option value="proxy">JSON 代理</option>
                                                <option value="raw">原始内容</option>
                                                <option value="reader">阅读模式</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-xs text-zinc-500 mb-1">采集模式</label>
                                            <select v-model="quickTestParams.mode"
                                                class="w-full bg-zinc-50 border border-zinc-300 rounded-lg px-3 py-2 text-sm outline-none">
                                                <option value="cookie">Cookie 复用</option>
                                                <option value="browser">浏览器直读</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-xs text-zinc-500 mb-1">代理模式</label>
                                            <select v-model="quickTestParams.proxy_mode"
                                                class="w-full bg-zinc-50 border border-zinc-300 rounded-lg px-3 py-2 text-sm outline-none">
                                                <option value="none">不使用代理</option>
                                                <option value="pool">使用 IP 池</option>
                                            </select>
                                        </div>
                                    </div>
                                    <!-- 测试结果 -->
                                    <div v-if="testResult" class="p-4 bg-zinc-50 border border-zinc-200 rounded-lg">
                                        <div class="flex justify-between items-center mb-3">
                                            <span
                                                :class="['font-semibold text-sm flex items-center gap-1.5', testResult.success ? 'text-green-600' : 'text-red-600']">
                                                <i
                                                    :class="testResult.success ? 'ri-checkbox-circle-fill' : 'ri-close-circle-fill'"></i>
                                                {{ testResult.success ? '成功' : '失败' }}
                                            </span>
                                            <span class="font-mono text-zinc-500 text-xs">{{ testResult.duration_ms
                                                }}ms</span>
                                        </div>
                                        <div v-if="testResult.error"
                                            class="text-xs text-red-600 p-2 bg-red-50 rounded border border-red-200">
                                            {{ testResult.error }}
                                        </div>
                                        <div v-if="testResult.success" class="space-y-2 text-xs">
                                            <div v-if="testResult.cookies_count" class="text-zinc-600">
                                                <span class="font-semibold">Cookies:</span> {{ testResult.cookies_count
                                                }} 个
                                            </div>
                                            <div v-if="testResult.content_length" class="text-zinc-600">
                                                <span class="font-semibold">内容长度:</span> {{
                                                testResult.content_length.toLocaleString() }} 字符
                                            </div>
                                            <div v-if="testResult.raw_length" class="text-zinc-600">
                                                <span class="font-semibold">原始长度:</span> {{
                                                testResult.raw_length.toLocaleString() }} 字节
                                            </div>
                                            <div v-if="testResult.status" class="text-zinc-600">
                                                <span class="font-semibold">状态码:</span> {{ testResult.status }}
                                            </div>
                                            <div v-if="testResult.data" class="mt-2 text-zinc-600">
                                                <span class="font-semibold block mb-1">提取数据:</span>
                                                <pre
                                                    class="bg-white p-2 rounded border border-zinc-200 text-[10px] overflow-auto max-h-32">{{ testResult.data }}</pre>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 批量测试 -->
                                    <div class="border-t border-zinc-200 pt-4 mt-4">
                                        <div class="flex items-center gap-2 mb-3">
                                            <i class="ri-stack-line text-orange-600"></i>
                                            <span class="text-sm font-semibold text-zinc-900">批量测试</span>
                                            <span class="text-xs text-zinc-500">（每行一个 URL，最多 10 个）</span>
                                        </div>
                                        <textarea v-model="batchTestUrls" rows="3"
                                            placeholder="https://example1.com&#10;https://example2.com&#10;https://example3.com"
                                            class="w-full bg-zinc-50 border border-zinc-300 rounded-lg px-4 py-2.5 text-sm font-mono outline-none focus:ring-2 focus:ring-orange-500 resize-none mb-3"></textarea>
                                        <div class="flex items-center gap-3">
                                            <button @click="batchTestBypass" :disabled="batchTesting || !batchTestUrls.trim()"
                                                class="px-4 py-2 bg-orange-600 hover:bg-orange-500 text-white text-sm font-medium rounded-lg disabled:opacity-50 flex items-center gap-2">
                                                <i v-if="!batchTesting" class="ri-play-circle-line"></i>
                                                <span class="loader w-4 h-4" v-else></span>
                                                {{ batchTesting ? '批量测试中...' : '开始批量测试' }}
                                            </button>
                                            <div v-if="batchTesting" class="flex items-center gap-2">
                                                <div class="w-32 h-2 bg-zinc-200 rounded-full overflow-hidden">
                                                    <div class="h-full bg-orange-500 transition-all" :style="{width: batchProgress + '%'}"></div>
                                                </div>
                                                <span class="text-xs text-zinc-500">{{ batchProgress }}%</span>
                                            </div>
                                        </div>
                                        <!-- 批量测试结果 -->
                                        <div v-if="batchTestResults" class="mt-4 p-4 bg-zinc-50 border border-zinc-200 rounded-lg">
                                            <div class="flex items-center justify-between mb-3">
                                                <span class="font-semibold text-sm text-zinc-900">批量测试结果</span>
                                                <div class="flex items-center gap-3 text-xs">
                                                    <span class="text-green-600"><i class="ri-checkbox-circle-fill mr-1"></i>成功: {{ batchTestResults.success }}</span>
                                                    <span class="text-red-600"><i class="ri-close-circle-fill mr-1"></i>失败: {{ batchTestResults.failed }}</span>
                                                    <span class="text-zinc-500">总计: {{ batchTestResults.total }}</span>
                                                </div>
                                            </div>
                                            <div class="space-y-2 max-h-48 overflow-y-auto">
                                                <div v-for="(r, idx) in batchTestResults.results" :key="idx"
                                                    :class="['p-2 rounded text-xs flex items-center justify-between',
                                                        r.success ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200']">
                                                    <div class="flex items-center gap-2 flex-1 min-w-0">
                                                        <i :class="r.success ? 'ri-checkbox-circle-fill text-green-600' : 'ri-close-circle-fill text-red-600'"></i>
                                                        <span class="font-mono truncate">{{ r.url }}</span>
                                                    </div>
                                                    <div class="flex items-center gap-2 flex-shrink-0 ml-2">
                                                        <span class="text-zinc-500">{{ r.duration_ms }}ms</span>
                                                        <span v-if="r.error" class="text-red-600 truncate" style="max-width: 8rem;" :title="r.error">{{ r.error }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 规则列表 -->
                            <div class="bg-white border border-zinc-200 rounded-xl shadow-lg overflow-hidden">
                                <div
                                    class="px-6 py-4 border-b border-zinc-200 bg-zinc-50 flex items-center justify-between">
                                    <div>
                                        <h3 class="text-sm font-semibold text-zinc-900 flex items-center gap-2">
                                            <i class="ri-magic-line text-purple-600"></i> 采集规则
                                        </h3>
                                        <p class="text-xs text-zinc-500 mt-1">创建规则后获取专属 Permlink，无需编码即可采集数据</p>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button @click="loadRules" :disabled="rulesLoading"
                                            class="px-3 py-2 bg-zinc-100 hover:bg-zinc-200 text-xs rounded-lg border border-zinc-200 flex items-center gap-2">
                                            <i class="ri-refresh-line"></i> 刷新
                                        </button>
                                        <button @click="openRuleForm()"
                                            class="px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white text-xs font-medium rounded-lg flex items-center gap-2">
                                            <i class="ri-add-line"></i> 新建规则
                                        </button>
                                    </div>
                                </div>

                                <!-- 规则表格 -->
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm">
                                        <thead class="bg-zinc-50 text-zinc-600 text-xs font-semibold uppercase">
                                            <tr>
                                                <th class="px-6 py-3 text-left">规则名称</th>
                                                <th class="px-6 py-3 text-left">目标 URL</th>
                                                <th class="px-6 py-3 text-center">接口</th>
                                                <th class="px-6 py-3 text-center">访问</th>
                                                <th class="px-6 py-3 text-left">Permlink</th>
                                                <th class="px-6 py-3 text-center">操作</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-zinc-200 text-zinc-700">
                                            <tr v-for="rule in rules" :key="rule.id"
                                                class="hover:bg-zinc-50 transition-all">
                                                <td class="px-6 py-4">
                                                    <div class="font-medium text-zinc-900">{{ rule.name }}</div>
                                                    <div class="text-xs text-zinc-500">{{
                                                        formatRuleTime(rule.created_at) }}</div>
                                                </td>
                                                <td class="px-6 py-4 font-mono text-xs max-w-xs truncate"
                                                    :title="rule.target_url">
                                                    {{ rule.target_url }}
                                                </td>
                                                <td class="px-6 py-4 text-center">
                                                    <span
                                                        :class="['inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium',
                                                        (rule.api_type || 'proxy') === 'proxy' ? 'bg-purple-100 text-purple-700' :
                                                        (rule.api_type || 'proxy') === 'raw' ? 'bg-blue-100 text-blue-700' : 'bg-green-100 text-green-700']">
                                                        {{ (rule.api_type || 'proxy') === 'proxy' ? 'JSON' :
                                                        (rule.api_type || 'proxy') === 'raw' ? 'Raw' : 'Reader' }}
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4 text-center">
                                                    <span
                                                        :class="['inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium',
                                                        rule.is_public ? 'bg-green-100 text-green-700' : 'bg-zinc-100 text-zinc-600']">
                                                        <i
                                                            :class="rule.is_public ? 'ri-lock-unlock-line mr-1' : 'ri-lock-line mr-1'"></i>
                                                        {{ rule.is_public ? '公开' : '私有' }}
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4">
                                                    <div class="flex items-center gap-2">
                                                        <code
                                                            class="text-xs bg-zinc-100 px-2 py-1 rounded font-mono text-purple-600">/v1/run/{{ rule.id }}</code>
                                                        <button @click="copyPermlink(rule)"
                                                            class="p-1 text-zinc-400 hover:text-purple-600 transition-all"
                                                            :title="copiedRuleId === rule.id ? '已复制!' : '复制链接'">
                                                            <i
                                                                :class="copiedRuleId === rule.id ? 'ri-check-line text-green-500' : 'ri-file-copy-line'"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 text-center">
                                                    <div class="flex items-center justify-center gap-1">
                                                        <button @click="testRule(rule)" :disabled="ruleTesting"
                                                            class="p-2 text-zinc-500 hover:text-green-600 hover:bg-green-50 rounded-lg transition-all"
                                                            title="测试规则">
                                                            <i class="ri-play-line"></i>
                                                        </button>
                                                        <button @click="openRuleForm(rule)"
                                                            class="p-2 text-zinc-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all"
                                                            title="编辑">
                                                            <i class="ri-edit-line"></i>
                                                        </button>
                                                        <button @click="deleteRule(rule)"
                                                            class="p-2 text-zinc-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all"
                                                            title="删除">
                                                            <i class="ri-delete-bin-line"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr v-if="rules.length === 0">
                                                <td colspan="6" class="px-6 py-16 text-center">
                                                    <i class="ri-magic-line text-4xl text-zinc-300 mb-2 block"></i>
                                                    <p class="text-zinc-500 text-sm mb-4">暂无采集规则</p>
                                                    <button @click="openRuleForm()"
                                                        class="px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white text-xs font-medium rounded-lg inline-flex items-center gap-2">
                                                        <i class="ri-add-line"></i> 创建第一个规则
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- 测试结果 -->
                            <div v-if="ruleTestResult" class="bg-white border border-zinc-200 rounded-xl p-6 shadow-lg">
                                <h3 class="text-sm font-semibold text-zinc-900 mb-4 flex items-center gap-2">
                                    <i class="ri-test-tube-line text-green-600"></i> 测试结果
                                </h3>
                                <div v-if="ruleTestResult.error"
                                    class="p-4 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm">
                                    <div class="font-semibold mb-1">错误：</div>
                                    {{ ruleTestResult.error }}
                                </div>
                                <div v-else class="space-y-4">
                                    <div v-if="ruleTestResult.meta" class="p-3 bg-zinc-50 rounded-lg">
                                        <div class="text-xs text-zinc-500 mb-1">规则信息</div>
                                        <div class="font-mono text-sm">{{ ruleTestResult.meta.name }} ({{
                                            ruleTestResult.meta.rule_id }})</div>
                                    </div>
                                    <div v-if="ruleTestResult.data && Object.keys(ruleTestResult.data).length > 0">
                                        <div class="text-xs text-zinc-500 mb-2">提取数据</div>
                                        <div class="space-y-2">
                                            <div v-for="(value, key) in ruleTestResult.data" :key="key"
                                                class="p-3 bg-green-50 border border-green-200 rounded-lg">
                                                <div class="text-xs font-semibold text-green-700 mb-1">{{ key }}</div>
                                                <div class="text-sm text-zinc-800 break-all">{{ value || '(空)' }}</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div v-if="ruleTestResult.raw_length" class="text-xs text-zinc-500">
                                        原始内容长度: {{ ruleTestResult.raw_length.toLocaleString() }} 字符
                                    </div>
                                </div>
                            </div>

                            <!-- 使用说明 -->
                            <div
                                class="bg-gradient-to-br from-purple-50 to-blue-50 border border-purple-200 rounded-xl p-6">
                                <h3 class="text-sm font-semibold text-purple-900 mb-3 flex items-center gap-2">
                                    <i class="ri-lightbulb-line"></i> 使用说明
                                </h3>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-xs text-purple-800">
                                    <div class="flex items-start gap-2">
                                        <span
                                            class="w-5 h-5 bg-purple-200 rounded-full flex items-center justify-center text-purple-700 font-bold flex-shrink-0">1</span>
                                        <div>
                                            <div class="font-semibold">创建规则</div>
                                            <div class="text-purple-600">填写目标 URL 和 CSS 选择器</div>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-2">
                                        <span
                                            class="w-5 h-5 bg-purple-200 rounded-full flex items-center justify-center text-purple-700 font-bold flex-shrink-0">2</span>
                                        <div>
                                            <div class="font-semibold">获取 Permlink</div>
                                            <div class="text-purple-600">保存后自动生成专属链接</div>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-2">
                                        <span
                                            class="w-5 h-5 bg-purple-200 rounded-full flex items-center justify-center text-purple-700 font-bold flex-shrink-0">3</span>
                                        <div>
                                            <div class="font-semibold">直接调用</div>
                                            <div class="text-purple-600">GET 请求 Permlink 即可获取数据</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 规则编辑弹窗 -->
                        <div v-if="showRuleForm" @click="showRuleForm = false"
                            class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div @click.stop
                                class="bg-white border border-zinc-200 rounded-2xl max-w-2xl w-full max-h-[85vh] overflow-y-auto shadow-2xl">
                                <div
                                    class="sticky top-0 bg-white border-b border-zinc-200 px-6 py-4 flex items-center justify-between">
                                    <h3 class="text-base font-semibold text-zinc-900">
                                        {{ editingRule ? '编辑规则' : '新建采集规则' }}
                                    </h3>
                                    <button @click="showRuleForm = false"
                                        class="p-2 text-zinc-500 hover:text-zinc-700 hover:bg-zinc-100 rounded-lg transition-all">
                                        <i class="ri-close-line text-xl"></i>
                                    </button>
                                </div>
                                <div class="p-6 space-y-5">
                                    <!-- 基本信息 -->
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-xs font-semibold text-zinc-700 mb-2">规则名称</label>
                                            <input v-model="ruleForm.name" type="text" placeholder="例如：获取商品价格"
                                                class="w-full bg-zinc-50 border border-zinc-300 rounded-lg px-4 py-2.5 text-sm text-zinc-900 focus:ring-2 focus:ring-purple-500 outline-none">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-semibold text-zinc-700 mb-2">接口类型</label>
                                            <select v-model="ruleForm.api_type"
                                                class="w-full bg-zinc-50 border border-zinc-300 rounded-lg px-4 py-2.5 text-sm text-zinc-900 focus:ring-2 focus:ring-purple-500 outline-none">
                                                <option value="proxy">JSON 代理（返回结构化数据）</option>
                                                <option value="raw">原始内容（返回二进制/原文）</option>
                                                <option value="reader">阅读模式（返回处理后 HTML）</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div>
                                        <label class="block text-xs font-semibold text-zinc-700 mb-2">目标 URL <span
                                                class="text-red-500">*</span></label>
                                        <input v-model="ruleForm.target_url" type="url"
                                            placeholder="https://example.com/page"
                                            class="w-full bg-zinc-50 border border-zinc-300 rounded-lg px-4 py-2.5 text-sm text-zinc-900 focus:ring-2 focus:ring-purple-500 outline-none font-mono">
                                    </div>

                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label class="block text-xs font-semibold text-zinc-700 mb-2">请求方式</label>
                                            <select v-model="ruleForm.method"
                                                class="w-full bg-zinc-50 border border-zinc-300 rounded-lg px-4 py-2.5 text-sm text-zinc-900 focus:ring-2 focus:ring-purple-500 outline-none">
                                                <option value="GET">GET</option>
                                                <option value="POST">POST</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-xs font-semibold text-zinc-700 mb-2">采集模式</label>
                                            <select v-model="ruleForm.mode"
                                                class="w-full bg-zinc-50 border border-zinc-300 rounded-lg px-4 py-2.5 text-sm text-zinc-900 focus:ring-2 focus:ring-purple-500 outline-none">
                                                <option value="cookie">Cookie 复用</option>
                                                <option value="browser">浏览器直读</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-xs font-semibold text-zinc-700 mb-2">访问控制</label>
                                            <select v-model="ruleForm.is_public"
                                                class="w-full bg-zinc-50 border border-zinc-300 rounded-lg px-4 py-2.5 text-sm text-zinc-900 focus:ring-2 focus:ring-purple-500 outline-none">
                                                <option :value="false">私有（需 API Key）</option>
                                                <option :value="true">公开（无需认证）</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- 高级配置 -->
                                    <div class="p-4 bg-green-50 border border-green-200 rounded-lg space-y-3">
                                        <div class="flex items-center gap-2 text-green-700 text-xs font-semibold">
                                            <i class="ri-settings-3-line"></i> 高级配置
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                            <div v-if="ruleForm.mode === 'browser'">
                                                <label class="block text-xs text-zinc-600 mb-1">等待元素（可选）</label>
                                                <input v-model="ruleForm.wait_for" type="text" placeholder=".content, #main, article"
                                                    class="w-full bg-white border border-zinc-300 rounded px-3 py-2 text-sm font-mono outline-none">
                                                <p class="text-xs text-zinc-500 mt-1">浏览器模式下等待指定元素出现后再采集</p>
                                            </div>
                                            <div>
                                                <label class="block text-xs text-zinc-600 mb-1">缓存时间（秒）</label>
                                                <input v-model.number="ruleForm.cache_ttl" type="number" min="0" placeholder="0 表示不缓存"
                                                    class="w-full bg-white border border-zinc-300 rounded px-3 py-2 text-sm outline-none">
                                                <p class="text-xs text-zinc-500 mt-1">相同请求在此时间内返回缓存结果</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 代理配置 -->
                                    <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg space-y-3">
                                        <div class="flex items-center gap-2 text-blue-700 text-xs font-semibold">
                                            <i class="ri-global-line"></i> 代理配置
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                            <div>
                                                <label class="block text-xs text-zinc-600 mb-1">代理模式</label>
                                                <select v-model="ruleForm.proxy_mode"
                                                    class="w-full bg-white border border-zinc-300 rounded px-3 py-2 text-sm outline-none">
                                                    <option value="none">不使用代理（直连）</option>
                                                    <option value="pool">使用 IP 池（自动轮换）</option>
                                                    <option value="fixed">指定代理 IP</option>
                                                </select>
                                            </div>
                                            <div v-if="ruleForm.proxy_mode === 'fixed'">
                                                <label class="block text-xs text-zinc-600 mb-1">代理地址</label>
                                                <input v-model="ruleForm.proxy" type="text"
                                                    placeholder="socks5://ip:port 或 http://ip:port"
                                                    class="w-full bg-white border border-zinc-300 rounded px-3 py-2 text-sm font-mono outline-none">
                                            </div>
                                        </div>
                                        <p class="text-xs text-blue-600">
                                            <i class="ri-information-line mr-1"></i>
                                            提示：使用 IP 池需要先在「代理管理」页面配置代理列表
                                        </p>
                                    </div>

                                    <!-- POST 请求体配置 -->
                                    <div v-if="ruleForm.method === 'POST'"
                                        class="p-4 bg-orange-50 border border-orange-200 rounded-lg space-y-3">
                                        <div class="flex items-center gap-2 text-orange-700 text-xs font-semibold">
                                            <i class="ri-send-plane-line"></i> POST 请求体配置
                                        </div>
                                        <div>
                                            <label class="block text-xs text-zinc-600 mb-1">Body 类型</label>
                                            <select v-model="ruleForm.body_type"
                                                class="w-full bg-white border border-zinc-300 rounded px-3 py-2 text-sm outline-none">
                                                <option value="none">无</option>
                                                <option value="json">JSON</option>
                                                <option value="form">Form (x-www-form-urlencoded)</option>
                                                <option value="raw">Raw Text</option>
                                            </select>
                                        </div>
                                        <div v-if="ruleForm.body_type !== 'none'">
                                            <label class="block text-xs text-zinc-600 mb-1">请求体内容</label>
                                            <textarea v-model="ruleForm.body" rows="3"
                                                placeholder="JSON: {key: value} / Form: key=value"
                                                class="w-full bg-white border border-zinc-300 rounded px-3 py-2 text-sm font-mono outline-none resize-none"></textarea>
                                        </div>
                                    </div>

                                    <!-- 自定义请求头 -->
                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <label class="text-xs font-semibold text-zinc-700">自定义请求头（可选）</label>
                                            <button @click="addHeader" type="button"
                                                class="text-xs text-blue-600 hover:text-blue-500 flex items-center gap-1">
                                                <i class="ri-add-line"></i> 添加
                                            </button>
                                        </div>
                                        <div class="space-y-2">
                                            <div v-for="(h, idx) in ruleForm.headers_list" :key="idx"
                                                class="flex items-center gap-2">
                                                <input v-model="h.key" type="text" placeholder="Header 名"
                                                    class="flex-1 bg-zinc-50 border border-zinc-300 rounded px-3 py-2 text-sm outline-none">
                                                <input v-model="h.value" type="text" placeholder="值"
                                                    class="flex-[2] bg-zinc-50 border border-zinc-300 rounded px-3 py-2 text-sm outline-none">
                                                <button @click="removeHeader(idx)" type="button"
                                                    class="p-2 text-zinc-400 hover:text-red-500">
                                                    <i class="ri-close-line"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- CSS 选择器（仅 proxy 模式） -->
                                    <div v-if="ruleForm.api_type === 'proxy'">
                                        <div class="flex items-center justify-between mb-2">
                                            <label class="text-xs font-semibold text-zinc-700">数据提取规则（CSS 选择器）</label>
                                            <button @click="addSelector" type="button"
                                                class="text-xs text-purple-600 hover:text-purple-500 flex items-center gap-1">
                                            <i class="ri-add-line"></i> 添加字段
                                        </button>
                                    </div>
                                    <div class="space-y-2">
                                        <div v-for="(sel, idx) in ruleForm.selectors" :key="idx"
                                            class="flex items-center gap-2 p-3 bg-zinc-50 rounded-lg border border-zinc-200">
                                            <input v-model="sel.key" type="text" placeholder="字段名，如 title"
                                                class="flex-1 bg-white border border-zinc-300 rounded px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-purple-500">
                                            <span class="text-zinc-400">:</span>
                                            <input v-model="sel.selector" type="text"
                                                placeholder="CSS 选择器，如 h1.title"
                                                class="flex-[2] bg-white border border-zinc-300 rounded px-3 py-2 text-sm font-mono outline-none focus:ring-2 focus:ring-purple-500">
                                            <button @click="removeSelector(idx)" type="button"
                                                class="p-2 text-zinc-400 hover:text-red-500 transition-all">
                                                <i class="ri-delete-bin-line"></i>
                                            </button>
                                        </div>
                                        <div v-if="ruleForm.selectors.length === 0"
                                            class="p-4 bg-zinc-50 rounded-lg border border-dashed border-zinc-300 text-center">
                                            <p class="text-xs text-zinc-500 mb-2">暂无提取规则，将返回完整响应</p>
                                            <button @click="addSelector" type="button"
                                                class="text-xs text-purple-600 hover:text-purple-500">
                                                <i class="ri-add-line mr-1"></i>添加第一个字段
                                            </button>
                                        </div>
                                    </div>
                                    <div class="mt-3 p-3 bg-purple-50 border border-purple-200 rounded-lg">
                                        <p class="text-xs text-purple-700 font-semibold mb-2">
                                            <i class="ri-lightbulb-line mr-1"></i>常用选择器示例
                                        </p>
                                        <div class="grid grid-cols-2 gap-2 text-xs text-purple-600 font-mono">
                                            <div><code>h1</code> - 标题</div>
                                            <div><code>.content</code> - class 选择</div>
                                            <div><code>#main</code> - ID 选择</div>
                                            <div><code>article p</code> - 嵌套选择</div>
                                            <div><code>[data-id]</code> - 属性选择</div>
                                            <div><code>div.box &gt; p</code> - 直接子元素</div>
                                        </div>
                                        <p class="text-xs text-zinc-500 mt-2">
                                            <i class="ri-information-line mr-1"></i>
                                            提示：使用浏览器 F12 查看元素，右键复制 CSS 选择器
                                        </p>
                                    </div>
                                </div>

                                <!-- 操作按钮 -->
                                <div class="flex justify-end gap-3 pt-4 border-t border-zinc-200">
                                    <button @click="showRuleForm = false" type="button"
                                        class="px-4 py-2.5 text-sm font-medium text-zinc-700 hover:text-zinc-900 hover:bg-zinc-100 border border-zinc-200 rounded-lg transition-all">
                                        取消
                                    </button>
                                    <button @click="saveRule" :disabled="rulesLoading"
                                        class="px-6 py-2.5 bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-500 hover:to-purple-400 text-white text-sm font-semibold rounded-lg shadow-lg disabled:opacity-50 flex items-center gap-2 transition-all">
                                        <span v-if="rulesLoading" class="loader w-4 h-4"></span>
                                        <i v-else class="ri-save-line"></i>
                                        {{ rulesLoading ? '保存中...' : (editingRule ? '更新规则' : '创建规则') }}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- USERS (Admin Only) -->
                    <div v-if="activeTab === 'users'" class="space-y-6">
                        <div class="bg-white border border-zinc-200 rounded-xl p-6 shadow-lg">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-sm font-semibold text-zinc-900 flex items-center gap-2"><i
                                            class="ri-key-2-line text-blue-600"></i> 用户与密钥</h3>
                                    <p class="text-xs text-zinc-500 mt-1">仅文件存储部分可管理，环境变量中的密钥视为只读</p>
                                </div>
                                <button @click="loadUsers" :disabled="userLoading"
                                    class="px-3 py-2 bg-zinc-100 hover:bg-zinc-200 text-xs rounded-lg border border-zinc-200 flex items-center gap-2">
                                    <i class="ri-refresh-line"></i> 刷新
                                </button>
                            </div>
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                                <div class="lg:col-span-2">
                                    <div class="overflow-x-auto">
                                        <table class="min-w-full text-sm">
                                            <thead>
                                                <tr class="text-left text-zinc-500">
                                                    <th class="py-2">用户</th>
                                                    <th class="py-2">角色</th>
                                                    <th class="py-2">Key</th>
                                                    <th class="py-2 text-right">操作</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr v-for="u in apiUsers" :key="u.user"
                                                    class="border-t border-zinc-100">
                                                    <td class="py-2 font-medium text-zinc-900">{{ u.user }}</td>
                                                    <td class="py-2 text-xs">
                                                        <span
                                                            :class="['px-2 py-1 rounded-full font-semibold', u.role === 'admin' ? 'bg-orange-100 text-orange-700' : 'bg-blue-100 text-blue-700']">
                                                            {{ u.role || 'user' }}
                                                        </span>
                                                    </td>
                                                    <td class="py-2 font-mono text-[11px] text-zinc-700 break-all">
                                                        {{ u.key }}
                                                    </td>
                                                    <td class="py-2 text-right flex items-center gap-2 justify-end">
                                                        <button @click="rotateUser(u)"
                                                            class="text-xs px-2 py-1 bg-zinc-100 hover:bg-zinc-200 rounded border border-zinc-200"
                                                            :disabled="rotatingUser===u.user">
                                                            {{ rotatingUser===u.user ? '重置中...' : '重置 Key' }}
                                                        </button>
                                                        <button @click="deleteUser(u)"
                                                            class="text-xs px-2 py-1 bg-red-50 hover:bg-red-100 text-red-600 rounded border border-red-200">删除</button>
                                                    </td>
                                                </tr>
                                                <tr v-if="!apiUsers.length">
                                                    <td colspan="4" class="py-4 text-center text-zinc-500 text-xs">
                                                        暂无可管理用户</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="bg-zinc-50 border border-zinc-200 rounded-xl p-4">
                                    <h4 class="text-sm font-semibold text-zinc-900 mb-3 flex items-center gap-2"><i
                                            class="ri-user-add-line text-green-600"></i> 创建用户</h4>
                                    <div class="space-y-3">
                                        <div>
                                            <label
                                                class="block text-xs font-semibold text-zinc-700 mb-1">用户名</label>
                                            <input v-model="newUserName"
                                                class="w-full bg-white border border-zinc-300 rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-semibold text-zinc-700 mb-1">角色</label>
                                            <select v-model="newUserRole"
                                                class="w-full bg-white border border-zinc-300 rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-500">
                                                <option value="user">user</option>
                                                <option value="admin">admin</option>
                                            </select>
                                        </div>
                                        <button @click="createUser" :disabled="userLoading"
                                            class="w-full px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white text-sm font-medium rounded-lg disabled:opacity-60 flex items-center justify-center gap-2">
                                            <i class="ri-add-line"></i> 创建并生成 Key
                                        </button>
                                        <p class="text-[11px] text-zinc-500">提示：环境变量中的密钥不可在此删除/修改，仅显示文件存储的用户。</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PROXIES 代理管理 -->
                    <div v-if="activeTab === 'proxies'" class="space-y-6">
                        <!-- 代理统计 -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-white border border-zinc-200 rounded-xl p-6 shadow-lg">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                                        <i class="ri-global-line text-2xl text-blue-600"></i>
                                    </div>
                                    <div>
                                        <div class="text-2xl font-bold text-zinc-900">{{ proxyStats.total }}</div>
                                        <div class="text-xs text-zinc-500">总代理数</div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white border border-zinc-200 rounded-xl p-6 shadow-lg">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                                        <i class="ri-check-double-line text-2xl text-green-600"></i>
                                    </div>
                                    <div>
                                        <div class="text-2xl font-bold text-green-600">{{ proxyStats.available }}
                                        </div>
                                        <div class="text-xs text-zinc-500">可用代理</div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white border border-zinc-200 rounded-xl p-6 shadow-lg">
                                <div class="flex items-center gap-3">
                                    <div
                                        class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                                        <i class="ri-shuffle-line text-2xl text-purple-600"></i>
                                    </div>
                                    <div>
                                        <div class="text-sm font-bold text-zinc-900">{{ proxyStats.strategy ===
                                            'round_robin' ? '轮询' : proxyStats.strategy }}</div>
                                        <div class="text-xs text-zinc-500">轮换策略</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 添加代理 -->
                        <div class="bg-white border border-zinc-200 rounded-xl p-6 shadow-lg">
                            <h3 class="text-sm font-semibold text-zinc-900 mb-4 flex items-center gap-2">
                                <i class="ri-add-circle-line text-blue-600"></i> 添加代理
                            </h3>
                            <div class="space-y-3">
                                <textarea v-model="newProxyText" rows="4"
                                    placeholder="每行一个代理地址，支持格式：&#10;socks5://ip:port&#10;http://user:pass@ip:port&#10;ip:port"
                                    class="w-full bg-zinc-50 border border-zinc-300 rounded-lg px-4 py-3 text-sm font-mono outline-none focus:ring-2 focus:ring-blue-500 resize-none"></textarea>
                                <div class="flex items-center gap-3">
                                    <button @click="addProxies" :disabled="proxyLoading"
                                        class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white text-sm font-medium rounded-lg flex items-center gap-2 disabled:opacity-50">
                                        <i class="ri-add-line"></i> 添加代理
                                    </button>
                                    <button @click="reloadProxies" :disabled="proxyLoading"
                                        class="px-4 py-2 bg-zinc-100 hover:bg-zinc-200 text-zinc-700 text-sm font-medium rounded-lg border border-zinc-200 flex items-center gap-2">
                                        <i class="ri-refresh-line"></i> 从文件重新加载
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 代理列表 -->
                        <div class="bg-white border border-zinc-200 rounded-xl shadow-lg overflow-hidden">
                            <div
                                class="px-6 py-4 border-b border-zinc-200 bg-zinc-50 flex items-center justify-between">
                                <h3 class="text-sm font-semibold text-zinc-900 flex items-center gap-2">
                                    <i class="ri-list-check text-blue-600"></i> 代理列表
                                </h3>
                                <button @click="loadProxies" :disabled="proxyLoading"
                                    class="px-3 py-1.5 bg-zinc-100 hover:bg-zinc-200 text-xs rounded-lg border border-zinc-200 flex items-center gap-1">
                                    <i class="ri-refresh-line"></i> 刷新
                                </button>
                            </div>
                            <div class="overflow-x-auto max-h-96">
                                <table class="w-full text-sm">
                                    <thead
                                        class="bg-zinc-50 text-zinc-600 text-xs font-semibold uppercase sticky top-0">
                                        <tr>
                                            <th class="px-6 py-3 text-left">代理地址</th>
                                            <th class="px-6 py-3 text-center">类型</th>
                                            <th class="px-6 py-3 text-center">状态</th>
                                            <th class="px-6 py-3 text-center">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-zinc-200">
                                        <tr v-for="(proxy, idx) in proxyList" :key="idx" class="hover:bg-zinc-50">
                                            <td class="px-6 py-3 font-mono text-xs">{{ proxy.address || proxy }}
                                            </td>
                                            <td class="px-6 py-3 text-center">
                                                <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded">
                                                    {{ (proxy.address || proxy).split('://')[0] || 'http' }}
                                                </span>
                                            </td>
                                            <td class="px-6 py-3 text-center">
                                                <span
                                                    :class="['px-2 py-1 text-xs rounded',
                                                    proxy.status === 'failed' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700']">
                                                    {{ proxy.status === 'failed' ? '失败' : '可用' }}
                                                </span>
                                            </td>
                                            <td class="px-6 py-3 text-center">
                                                <button @click="removeProxy(proxy.address || proxy)"
                                                    class="p-1.5 text-zinc-400 hover:text-red-500 hover:bg-red-50 rounded transition-all"
                                                    title="删除">
                                                    <i class="ri-delete-bin-line"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        <tr v-if="proxyList.length === 0">
                                            <td colspan="4" class="px-6 py-12 text-center">
                                                <i class="ri-global-line text-4xl text-zinc-300 mb-2 block"></i>
                                                <p class="text-zinc-500 text-sm">暂无代理，请添加或从文件加载</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 使用说明 -->
                        <div
                            class="bg-gradient-to-br from-blue-50 to-cyan-50 border border-blue-200 rounded-xl p-6">
                            <h3 class="text-sm font-semibold text-blue-900 mb-3 flex items-center gap-2">
                                <i class="ri-lightbulb-line"></i> 使用说明
                            </h3>
                            <div class="text-xs text-blue-800 space-y-2">
                                <p><strong>代理格式：</strong>支持 http://、https://、socks5:// 协议，可带认证信息</p>
                                <p><strong>文件加载：</strong>代理列表存储在 data/proxies.txt，每行一个</p>
                                <p><strong>规则配置：</strong>在规则配置中选择「使用 IP 池」即可自动轮换代理</p>
                            </div>
                        </div>
                    </div>

                    <!-- LOGS -->
                    <div v-if="activeTab === 'logs'" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white border border-zinc-200 rounded-xl overflow-hidden shadow-lg">
                            <div
                                class="px-6 py-4 border-b border-zinc-200 flex items-center justify-between bg-zinc-50">
                                <div>
                                    <h3 class="text-sm font-semibold text-zinc-900">全局日志</h3>
                                    <p class="text-xs text-zinc-500 mt-0.5 flex items-center gap-1">
                                        <i class="ri-pulse-line"></i> 实时服务器日志（SSE 优先，断开回退轮询）
                                    </p>
                                </div>
                                <div class="flex items-center gap-2">
                                    <select v-model="logFilter"
                                        class="text-xs bg-white border border-zinc-200 text-zinc-900 rounded-lg px-2 py-1.5 outline-none">
                                        <option value="all">所有级别</option>
                                        <option value="info">信息</option>
                                        <option value="warning">警告</option>
                                        <option value="error">错误</option>
                                        <option value="success">成功</option>
                                    </select>
                                    <button @click="clearLogs"
                                        class="text-xs text-zinc-600 hover:text-zinc-900 flex items-center gap-1 px-3 py-1.5 border border-zinc-200 rounded-lg hover:bg-zinc-50">
                                        <i class="ri-delete-bin-line"></i> 清空
                                    </button>
                                    <button @click="exportLogs"
                                        class="text-xs text-zinc-600 hover:text-zinc-900 flex items-center gap-1 px-3 py-1.5 border border-zinc-200 rounded-lg hover:bg-zinc-50">
                                        <i class="ri-download-line"></i> 导出
                                    </button>
                                </div>
                            </div>
                            <div class="h-[520px] overflow-y-auto bg-zinc-50 p-4 font-mono text-xs">
                                <div v-for="(log, i) in filteredLogs" :key="i"
                                    :class="['log-line', `log-${log.level}`]">
                                    <span class="text-zinc-500">[{{ log.timestamp }}]</span>
                                    <span class="font-semibold ml-2">[{{ log.level.toUpperCase() }}]</span>
                                    <span class="ml-2">{{ log.message }}</span>
                                </div>
                                <div v-if="filteredLogs.length === 0" class="text-center text-zinc-500 py-12">暂无日志显示
                                </div>
                            </div>
                        </div>

                        <div class="bg-white border border-zinc-200 rounded-xl overflow-hidden shadow-lg">
                            <div
                                class="px-6 py-4 border-b border-zinc-200 flex items-center justify-between bg-zinc-50">
                                <div>
                                    <h3 class="text-sm font-semibold text-zinc-900">用户日志</h3>
                                    <p class="text-xs text-zinc-500 mt-0.5">仅显示当前筛选用户的日志</p>
                                </div>
                                <div class="flex items-center gap-2">
                                    <select v-model="logFilter"
                                        class="text-xs bg-white border border-zinc-200 text-zinc-900 rounded-lg px-2 py-1.5 outline-none">
                                        <option value="all">所有级别</option>
                                        <option value="info">信息</option>
                                        <option value="warning">警告</option>
                                        <option value="error">错误</option>
                                        <option value="success">成功</option>
                                    </select>
                                    <button @click="exportLogs"
                                        class="text-xs text-zinc-600 hover:text-zinc-900 flex items-center gap-1 px-3 py-1.5 border border-zinc-200 rounded-lg hover:bg-zinc-50">
                                        <i class="ri-download-line"></i> 导出
                                    </button>
                                </div>
                            </div>
                            <div class="h-[520px] overflow-y-auto bg-zinc-50 p-4 font-mono text-xs">
                                <div v-for="(log, i) in filteredUserLogs" :key="i"
                                    :class="['log-line', `log-${log.level}`]">
                                    <span class="text-zinc-500">[{{ log.timestamp }}]</span>
                                    <span class="font-semibold ml-2">[{{ log.level.toUpperCase() }}]</span>
                                    <span class="ml-2">{{ log.message }}</span>
                                </div>
                                <div v-if="filteredUserLogs.length === 0" class="text-center text-zinc-500 py-12">
                                    暂无该用户日志</div>
                            </div>
                        </div>
                    </div>

                    <!-- POOL -->
                    <div v-if="activeTab === 'pool'" class="space-y-6">
                        <div class="bg-white border border-zinc-200 rounded-xl overflow-hidden shadow-lg">
                            <div
                                class="px-6 py-4 border-b border-zinc-200 flex justify-between items-center bg-zinc-50">
                                <div>
                                    <h3 class="text-sm font-semibold text-zinc-900">浏览器实例</h3>
                                    <p class="text-xs text-zinc-500 mt-0.5">{{ browserPoolInfo.total || 0 }} 总计, {{
                                        browserPoolInfo.available || 0 }} 可用</p>
                                </div>
                                <button @click="restartBrowserPool"
                                    class="text-xs text-zinc-600 hover:text-zinc-900 flex items-center gap-1.5 px-3 py-2 border border-zinc-200 rounded-lg hover:bg-zinc-50">
                                    <i class="ri-restart-line"></i> 重启池
                                </button>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead class="bg-zinc-50 text-zinc-600 text-xs font-semibold uppercase">
                                        <tr>
                                            <th class="px-6 py-3 text-left">实例 ID</th>
                                            <th class="px-6 py-3 text-left">进程 ID</th>
                                            <th class="px-6 py-3 text-left">状态</th>
                                            <th class="px-6 py-3 text-left">使用次数</th>
                                            <th class="px-6 py-3 text-left">创建时间</th>
                                            <th class="px-6 py-3 text-left">最后使用</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-zinc-200 text-zinc-700">
                                        <tr v-for="inst in browserPoolInfo.instances" :key="inst.id"
                                            class="hover:bg-zinc-50 transition-all">
                                            <td class="px-6 py-4 font-mono text-zinc-600">#{{ inst.id }}</td>
                                            <td class="px-6 py-4 font-mono">{{ inst.pid }}</td>
                                            <td class="px-6 py-4">
                                                <span
                                                    :class="['inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-semibold',
                                                    inst.in_use ? 'bg-yellow-100 text-yellow-700' : 'bg-blue-100 text-blue-700']">
                                                    <span
                                                        :class="['w-1.5 h-1.5 rounded-full mr-1.5', inst.in_use ? 'bg-yellow-500' : 'bg-blue-500']"></span>
                                                    {{ inst.in_use ? '使用中' : '空闲' }}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4">{{ inst.use_count }}</td>
                                            <td class="px-6 py-4 text-zinc-600">{{ inst.created_at }}</td>
                                            <td class="px-6 py-4 text-zinc-600">{{ inst.last_used }}</td>
                                        </tr>
                                        <tr v-if="!browserPoolInfo.instances?.length">
                                            <td colspan="6" class="px-6 py-16 text-center">
                                                <i class="ri-cpu-line text-4xl text-zinc-300 mb-2 block"></i>
                                                <p class="text-zinc-500 text-sm">暂无浏览器实例运行</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- CACHE -->
                    <div v-if="activeTab === 'cache'" class="space-y-6">
                        <div class="bg-white border border-zinc-200 rounded-xl p-6 shadow-lg">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <h3 class="text-base font-semibold text-zinc-900">缓存统计</h3>
                                    <p class="text-sm text-zinc-500 mt-1">凭证缓存性能指标</p>
                                </div>
                                <button @click="clearAllCache"
                                    class="px-4 py-2 bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 rounded-lg text-sm font-medium flex items-center gap-2 transition-all">
                                    <i class="ri-delete-bin-line"></i> 清空全部缓存
                                </button>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                <div
                                    class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-5">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="text-xs font-semibold text-blue-700">总条目</div>
                                        <i class="ri-database-2-line text-blue-600 text-xl"></i>
                                    </div>
                                    <div class="text-3xl font-bold text-blue-900">{{ stats.cache?.total || 0 }}
                                    </div>
                                </div>
                                <div
                                    class="bg-gradient-to-br from-green-50 to-green-100 border border-green-200 rounded-xl p-5">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="text-xs font-semibold text-green-700">命中率</div>
                                        <i class="ri-speed-up-line text-green-600 text-xl"></i>
                                    </div>
                                    <div class="text-3xl font-bold text-green-900">{{ stats.cache?.hit_rate || 0 }}%
                                    </div>
                                </div>
                                <div
                                    class="bg-gradient-to-br from-purple-50 to-purple-100 border border-purple-200 rounded-xl p-5">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="text-xs font-semibold text-purple-700">存储大小</div>
                                        <i class="ri-hard-drive-2-line text-purple-600 text-xl"></i>
                                    </div>
                                    <div class="text-3xl font-bold text-purple-900">{{
                                        formatBytes(stats.cache?.size_bytes || 0) }}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CONFIG -->
                    <div v-if="activeTab === 'config'" class="space-y-6 max-w-4xl">
                        <div class="bg-white border border-zinc-200 rounded-xl p-6 shadow-lg">
                            <h3 class="text-sm font-semibold text-zinc-900 mb-4">配置预设</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <button @click="applyPreset('development')"
                                    class="p-4 border-2 border-zinc-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all text-left">
                                    <div class="flex items-center gap-3 mb-2">
                                        <i class="ri-code-s-slash-line text-2xl text-blue-600"></i>
                                        <div class="text-sm font-semibold text-zinc-900">开发环境</div>
                                    </div>
                                    <p class="text-xs text-zinc-500">最小池，快速回收</p>
                                </button>
                                <button @click="applyPreset('production')"
                                    class="p-4 border-2 border-zinc-200 rounded-xl hover:border-green-500 hover:bg-green-50 transition-all text-left">
                                    <div class="flex items-center gap-3 mb-2">
                                        <i class="ri-rocket-line text-2xl text-green-600"></i>
                                        <div class="text-sm font-semibold text-zinc-900">生产环境</div>
                                    </div>
                                    <p class="text-xs text-zinc-500">高流量优化</p>
                                </button>
                                <button @click="applyPreset('conservative')"
                                    class="p-4 border-2 border-zinc-200 rounded-xl hover:border-purple-500 hover:bg-purple-50 transition-all text-left">
                                    <div class="flex items-center gap-3 mb-2">
                                        <i class="ri-shield-check-line text-2xl text-purple-600"></i>
                                        <div class="text-sm font-semibold text-zinc-900">保守模式</div>
                                    </div>
                                    <p class="text-xs text-zinc-500">低资源占用</p>
                                </button>
                            </div>
                        </div>

                        <div class="bg-white border border-zinc-200 rounded-xl overflow-hidden shadow-lg">
                            <div class="px-6 py-4 border-b border-zinc-200 bg-zinc-50">
                                <h3 class="text-base font-semibold text-zinc-900">实例池设置</h3>
                                <p class="text-sm text-zinc-500 mt-1">配置浏览器资源分配</p>
                            </div>
                            <div class="p-6 grid gap-6">
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-semibold text-zinc-700 mb-2">最小实例数</label>
                                        <input type="number" v-model.number="config.browser_pool_min"
                                            class="w-full bg-zinc-50 border border-zinc-300 rounded-lg px-4 py-2.5 text-sm text-zinc-900 focus:ring-2 focus:ring-blue-500 outline-none">
                                        <p class="text-xs text-zinc-500 mt-2">保持预热的基准浏览器数量</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-zinc-700 mb-2">最大实例数</label>
                                        <input type="number" v-model.number="config.browser_pool_max"
                                            class="w-full bg-zinc-50 border border-zinc-300 rounded-lg px-4 py-2.5 text-sm text-zinc-900 focus:ring-2 focus:ring-blue-500 outline-none">
                                        <p class="text-xs text-zinc-500 mt-2">自动扩展的硬性限制</p>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-zinc-700 mb-2">空闲超时 (秒)</label>
                                    <input type="number" v-model.number="config.browser_pool_idle_timeout"
                                        class="w-full bg-zinc-50 border border-zinc-300 rounded-lg px-4 py-2.5 text-sm text-zinc-900 focus:ring-2 focus:ring-blue-500 outline-none">
                                    <p class="text-xs text-zinc-500 mt-2">空闲浏览器被回收前的等待时间</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-zinc-700 mb-2">内存硬限制 (MB)</label>
                                    <input type="number" v-model.number="config.memory_limit_mb"
                                        class="w-full bg-zinc-50 border border-zinc-300 rounded-lg px-4 py-2.5 text-sm text-zinc-900 focus:ring-2 focus:ring-blue-500 outline-none">
                                    <p class="text-xs text-zinc-500 mt-2">超过此值容器将重启</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white border border-zinc-200 rounded-xl overflow-hidden shadow-lg">
                            <div class="px-6 py-4 border-b border-zinc-200 bg-zinc-50">
                                <h3 class="text-base font-semibold text-zinc-900">过盾策略</h3>
                                <p class="text-sm text-zinc-500 mt-1">微调检测规避参数</p>
                            </div>
                            <div class="p-6 grid gap-6">
                                <div>
                                    <label class="block text-sm font-semibold text-zinc-700 mb-2">Token 有效期
                                        (秒)</label>
                                    <input type="number" v-model.number="config.cookie_expire_seconds"
                                        class="w-full bg-zinc-50 border border-zinc-300 rounded-lg px-4 py-2.5 text-sm text-zinc-900 focus:ring-2 focus:ring-blue-500 outline-none">
                                    <p class="text-xs text-zinc-500 mt-2">Cloudflare token 被视为有效的时长</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-zinc-700 mb-2">指纹随机化</label>
                                    <select v-model="config.fingerprint_enabled"
                                        class="w-full bg-zinc-50 border border-zinc-300 rounded-lg px-4 py-2.5 text-sm text-zinc-900 focus:ring-2 focus:ring-blue-500 outline-none">
                                        <option :value="true">启用（推荐）</option>
                                        <option :value="false">禁用</option>
                                    </select>
                                    <p class="text-xs text-zinc-500 mt-2">为每个实例随机化 Canvas/WebGL/Audio 指纹</p>
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-end gap-3 pt-4">
                            <button @click="exportConfig"
                                class="px-4 py-2.5 text-sm font-medium text-zinc-700 hover:text-zinc-900 hover:bg-zinc-100 border border-zinc-200 rounded-lg flex items-center gap-2 transition-all">
                                <i class="ri-download-line"></i> 导出 JSON
                            </button>
                            <button @click="saveConfig" :disabled="saving"
                                class="px-6 py-2.5 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white text-sm font-semibold rounded-lg shadow-lg shadow-blue-500/30 disabled:opacity-50 flex items-center gap-2 transition-all">
                                <span v-if="saving" class="flex items-center gap-2">
                                    <span class="loader w-4 h-4"></span> 保存中...
                                </span>
                                <span v-else class="flex items-center gap-2">
                                    <i class="ri-save-line"></i> 保存配置
                                </span>
                            </button>
                        </div>
                    </div>

                </div>
            </main>
        </div>
    </template>

    <!-- Detail Modal -->
    <div v-if="selectedRequest" @click="selectedRequest = null"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div @click.stop
            class="bg-white border border-zinc-200 rounded-2xl max-w-2xl w-full max-h-[80vh] overflow-y-auto shadow-2xl">
            <div class="sticky top-0 bg-white border-b border-zinc-200 px-6 py-4 flex items-center justify-between">
                <h3 class="text-base font-semibold text-zinc-900">请求详情</h3>
                <button @click="selectedRequest = null"
                    class="p-2 text-zinc-500 hover:text-zinc-700 hover:bg-zinc-100 rounded-lg transition-all">
                    <i class="ri-close-line text-xl"></i>
                </button>
            </div>
            <div class="p-6 space-y-5">
                <div>
                    <label class="text-xs font-semibold text-zinc-600 uppercase">状态</label>
                    <div :class="['mt-2 inline-flex items-center px-3 py-1.5 rounded-lg text-sm font-semibold',
                        selectedRequest.success ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700']">
                        <i
                            :class="selectedRequest.success ? 'ri-checkbox-circle-fill mr-2' : 'ri-close-circle-fill mr-2'"></i>
                        {{ selectedRequest.success ? '成功' : '失败' }}
                    </div>
                </div>
                <div>
                    <label class="text-xs font-semibold text-zinc-600 uppercase">URL</label>
                    <div
                        class="mt-2 p-4 bg-zinc-50 border border-zinc-200 rounded-lg font-mono text-sm text-zinc-900 break-all">
                        {{ selectedRequest.url }}
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-semibold text-zinc-600 uppercase">耗时</label>
                        <div
                            class="mt-2 p-4 bg-zinc-50 border border-zinc-200 rounded-lg font-mono text-sm text-zinc-900">
                            {{ selectedRequest.duration_ms }}ms
                        </div>
                    </div>
                    <div>
                        <label class="text-xs font-semibold text-zinc-600 uppercase">时间戳</label>
                        <div
                            class="mt-2 p-4 bg-zinc-50 border border-zinc-200 rounded-lg font-mono text-sm text-zinc-900">
                            {{ selectedRequest.timestamp }}
                        </div>
                    </div>
                </div>
                <div v-if="selectedRequest.error">
                    <label class="text-xs font-semibold text-zinc-600 uppercase">错误信息</label>
                    <div class="mt-2 p-4 bg-red-50 border border-red-200 rounded-lg text-sm text-red-700 break-all">
                        {{ selectedRequest.error }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div v-if="toast.show" class="fixed bottom-6 right-6 z-50">
        <div :class="['px-5 py-4 rounded-xl shadow-2xl flex items-center gap-3 text-sm font-medium border backdrop-blur-md',
            toast.type === 'success' ? 'bg-green-50 text-green-700 border-green-200' :
            toast.type === 'error' ? 'bg-red-50 text-red-700 border-red-200' :
            'bg-blue-50 text-blue-700 border-blue-200']">
            <i
                :class="toast.type === 'success' ? 'ri-checkbox-circle-fill text-xl' : toast.type === 'error' ? 'ri-error-warning-fill text-xl' : 'ri-information-fill text-xl'"></i>
            {{ toast.message }}
        </div>
    </div>
    </div>
    <!-- 模块化 JavaScript 文件 -->
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/api.js"></script>
    <script src="/static/js/state.js"></script>
    <script src="/static/js/components.js"></script>
    <script src="/static/js/sse.js"></script>
    <script src="/static/js/app.js"></script>
</body>

</html>
